<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      throwConfigExceptions="true"
      internalLogLevel="info"
      internalLogFile="internal-nlog.txt">

  <targets>
    <target archiveEvery="Day" encoding="UTF-8" xsi:type="File" name="Microsoft" fileName="logs\Microsoft-${shortdate}.json" >
      <layout xsi:type="JsonLayout" includeAllProperties="true" >
        <attribute name="time" layout="${longdate}" />
        <attribute name="event-properties" layout="${event-properties:item=EventId_Id:whenEmpty=0}" />
        <attribute name="level" layout="${level:upperCase=true}"/>
        <attribute name="logger" layout="${logger}" />
        <attribute name="message" layout="${message}" />
        <attribute name="exception" layout="${exception:format=@}" />
        <attribute name="callsite" layout="${callsite}" />
        <attribute name="exceptions" encode="false">
          <layout type="JsonLayout">
            <attribute name="exception" encode="false">
              <layout type="JsonLayout">
                <attribute name="message" layout="${exception:format=message}" />
                <attribute name="stacktrace" layout="${exception:format=stacktrace}" />
                <attribute name="data" layout="${exception:format=data}" />
                <attribute name="type" layout="${exception:format=type}" />
                <attribute name="method" layout="${exception:format=method}" />
              </layout>
            </attribute>
          </layout>
        </attribute>
       </layout>
    </target>

    <target name="LogConsole" xsi:type="ColoredConsole" >
      <layout xsi:type="JsonLayout" includeAllProperties="true" >
        <attribute name="time" layout="${longdate}" />
        <attribute name="level" layout="${level:upperCase=true}"/>
        <attribute name="callsite" layout="${callsite}" />
        <attribute name="line" layout="${callsite-linenumber}" />
        <attribute name="message" layout="${message}" />
        <attribute name="exception" layout="${exception:format=@}" />
        <attribute name="exceptions" encode="false">
          <layout type="JsonLayout">
            <attribute name="exception" encode="false">
              <layout type="JsonLayout">
                <attribute name="message" layout="${exception:format=message}" />
                <attribute name="stacktrace" layout="${exception:format=stacktrace}" />
                <attribute name="data" layout="${exception:format=data}" />
                <attribute name="type" layout="${exception:format=type}" />
                <attribute name="method" layout="${exception:format=method}" />
              </layout>
            </attribute>
          </layout>
        </attribute>
       </layout>
    </target>

  </targets>

  <rules>
    <logger name="*" minLevel="Trace" writeTo="LogConsole" />
    <logger name="Microsoft.*" maxlevel="Info" writeTo="Microsoft" final="true" />
  </rules>
</nlog>